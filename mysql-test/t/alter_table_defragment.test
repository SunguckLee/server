--source include/have_partition.inc
--source include/have_xtradb.inc
--source include/master-slave.inc

--disable_warnings
drop table if exists t1;
drop table if exists t2;
drop table if exists t3;
drop table if exists t4;
--enable_warnings

create table t1(a int not null primary key auto_increment, b varchar(256), key second(b)) engine=innodb;
create table t2(a int not null primary key auto_increment, b varchar(256)) engine=myisam;

insert into t1 values (1, REPEAT("a", 256));
insert into t1 values (2, REPEAT("a", 256));
optimize table t1;

optimize table t1 index primary;

optimize table t1 index second;

optimize table t1 index notexist;

insert into t2 values (1, REPEAT("a", 256));
insert into t2 values (2, REPEAT("a", 256));

optimize table t2;

optimize table t3;

create table t4 (a int not null primary key auto_increment, b varchar(256), key second(b)) engine=innodb partition by range(a)(partition p0 values less than (10) engine=innodb, partition p1 values less than (20) engine=innodb);
insert into t4 values (1, REPEAT("a", 256));
insert into t4 values (11, REPEAT("a", 256));

alter table t4 optimize partition p0;
alter table t4 optimize partition p0, p1;
alter table t4 optimize partition p3;
alter table t4 optimize partition p0, p1 index second;

--replace_regex /\/\*.*//
show binlog events in 'master-bin.000001' from 313;

drop table t1;
drop table t2;
drop table t4;

--source include/rpl_end.inc
